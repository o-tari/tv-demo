import{u as me,a as ge,T as he,U as G,j as e,V as ue,W as Q}from"./index-B7Om342z.js";import{e as pe,u as be,r as a}from"./router-LUHdcDgl.js";import{h as u}from"./hianime-F0r3trgY.js";import{M as I}from"./MediaGrid-B-CXhoQ4.js";import"./vendor-gH-7aFTg.js";import"./redux-uMWmO1IK.js";import"./utils-COe-vthL.js";import"./formatNumber-CanhB8v4.js";import"./formatTime-BiH8Yqa9.js";import"./LazyImage-qkvR2N8q.js";const Ae=()=>{const{animeId:d}=pe(),g=be(),y=me(),j=ge(he),[x,J]=a.useState(null),[X,f]=a.useState(!0),[E,v]=a.useState(null),[N,Y]=a.useState(null),[Z,A]=a.useState(!1),[L,C]=a.useState(null),[r,M]=a.useState(null),[n,ee]=a.useState(null),[se,$]=a.useState(!1),[D,T]=a.useState(null),[m,k]=a.useState(null),[o,H]=a.useState("sub"),[U,w]=a.useState(null),[te,P]=a.useState(!1),[B,W]=a.useState(null),[l,re]=a.useState(null);a.useEffect(()=>{if(!d){g("/hianime");return}if(!j){v("HiAnime API key is not configured. Please add your API key in Settings."),f(!1);return}u.setApiKey(j),ae(),F()},[d,j,g]);const ae=async()=>{if(d)try{f(!0),v(null);const s=await u.getAnimeInfo(d);J(s)}catch(s){v(s instanceof Error?s.message:"Failed to load anime information")}finally{f(!1)}},F=async()=>{if(d)try{A(!0),C(null);const s=await u.getAnimeEpisodes(d);Y(s);const t=G(d);if(s.episodes.length>0){let i;if(t){const h=s.episodes.find(p=>p.episodeId===t.episodeId);h?(i=h,H(t.language)):i=s.episodes[s.episodes.length-1]}else i=s.episodes[s.episodes.length-1];M(i),S(i.episodeId)}}catch(s){C(s instanceof Error?s.message:"Failed to load episodes")}finally{A(!1)}},S=async s=>{try{$(!0),T(null);const t=await u.getEpisodeServers(s);ee(t);const i=d?G(d):null,h=t[o]||t.sub||t.dub;if(h.length>0){let p=h[0];if(i&&i.serverId){const q=h.find(xe=>xe.serverId===i.serverId);q&&(p=q)}k(p),b(s,p.serverId)}}catch(t){T(t instanceof Error?t.message:"Failed to load episode servers")}finally{$(!1)}},b=async(s,t)=>{try{P(!0),W(null);const i=await u.getEpisodeStreamingUrl(s,t,o);w(i.url),re(i)}catch(i){W(i instanceof Error?i.message:"Failed to load streaming URL")}finally{P(!1)}},ie=s=>{if(M(s),S(s.episodeId),x?.anime?.info){const t=u.convertInfoToMedia(x.anime.info);y(ue(t)),y(Q({animeId:x.anime.info.id,episodeId:s.episodeId,episodeNumber:s.number,episodeTitle:s.title,language:o}))}},O=s=>{if(H(s),w(null),n){const t=n[s]||n.sub||n.dub;t.length>0&&(k(t[0]),r&&b(r.episodeId,t[0].serverId))}},R=s=>{k(s),w(null),r&&(b(r.episodeId,s.serverId),x?.anime?.info&&y(Q({animeId:x.anime.info.id,episodeId:r.episodeId,episodeNumber:r.number,episodeTitle:r.title,serverId:s.serverId,serverName:s.serverName,language:o})))};if(X)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})})})});if(E)return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:E}),e.jsx("button",{onClick:()=>g("/hianime"),className:"btn-primary",children:"Back to HiAnime"})]});if(!x)return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Anime not found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"The requested anime could not be found"}),e.jsx("button",{onClick:()=>g("/hianime"),className:"btn-primary mt-4",children:"Back to HiAnime"})]});const{info:c,moreInfo:de}=x.anime||{},{mostPopularAnimes:le,seasons:ne,relatedAnimes:oe,recommendedAnimes:ce}=x||{},z=(le||[]).map(s=>({id:s.id,title:s.name,image:s.poster,url:`/hianime/${s.id}`,type:"hianime",jname:s.jname,episodes:s.episodes,totalEpisodes:s.episodes.sub||s.episodes.dub||0,subOrDub:s.episodes.sub?"sub":"dub",animeType:s.type})),K=(ne||[]).map(s=>({id:s.id,title:s.name,image:s.poster,url:`/hianime/${s.id}`,type:"hianime",description:s.title,animeType:"TV",totalEpisodes:0,subOrDub:"sub"})),V=(oe||[]).map(s=>({id:s.id,title:s.name,image:s.poster,url:`/hianime/${s.id}`,type:"hianime",jname:s.jname,episodes:s.episodes,totalEpisodes:s.episodes.sub||s.episodes.dub||0,subOrDub:s.episodes.sub?"sub":"dub",animeType:s.type})),_=(ce||[]).map(s=>({id:s.id,title:s.name,image:s.poster,url:`/hianime/${s.id}`,type:"hianime",jname:s.jname,episodes:s.episodes,totalEpisodes:s.episodes.sub||s.episodes.dub||0,subOrDub:s.episodes.sub?"sub":"dub",animeType:s.type,duration:s.duration,rating:s.rating||void 0}));return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>g("/hianime"),className:"mb-6 flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to HiAnime"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"aspect-video bg-gray-900 dark:bg-gray-800 rounded-lg overflow-hidden",children:te?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300",children:"Loading player..."})]})}):B?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Failed to load player"}),e.jsx("p",{className:"text-gray-300 mb-4",children:B}),e.jsx("button",{onClick:()=>r&&m&&b(r.episodeId,m.serverId),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})}):U?e.jsxs("div",{className:"w-full h-full",children:[e.jsx("iframe",{src:U,className:"w-full h-full",title:`${r?.title||"Episode"} - ${m?.serverName||"Server"}`,allow:"autoplay; fullscreen; picture-in-picture; encrypted-media",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",loading:"lazy"}),l?.sources&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Streaming Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Quality Sources:"}),e.jsxs("p",{className:"text-gray-300",children:[l.sources.sources?.length||0," source(s) available"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Subtitles:"}),e.jsxs("p",{className:"text-gray-300",children:[l.sources.tracks?.length||0," language(s) available"]})]}),l.sources.intro&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Intro:"}),e.jsxs("p",{className:"text-gray-300",children:[Math.floor(l.sources.intro.start/60),":",(l.sources.intro.start%60).toString().padStart(2,"0")," - ",Math.floor(l.sources.intro.end/60),":",(l.sources.intro.end%60).toString().padStart(2,"0")]})]}),l.sources.outro&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Outro:"}),e.jsxs("p",{className:"text-gray-300",children:[Math.floor(l.sources.outro.start/60),":",(l.sources.outro.start%60).toString().padStart(2,"0")," - ",Math.floor(l.sources.outro.end/60),":",(l.sources.outro.end%60).toString().padStart(2,"0")]})]})]})]})]}):r&&m?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:r.title}),e.jsxs("p",{className:"text-gray-300",children:["Server: ",m.serverName," | Language: ",o.toUpperCase()]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Loading streaming URL..."})]})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-300",children:"Select an episode to start watching"})]})})}),r&&e.jsx("div",{className:"flex justify-end",children:e.jsx("a",{href:`https://hianime.to/watch/${d}?ep=${r.episodeId.split("?ep=").pop()||r.episodeId}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",title:`Open Episode ${r.number} on HiAnime.to`,children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})}),N&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Episodes (",N.totalEpisodes,")"]}),e.jsxs("div",{className:"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>O("sub"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="sub"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"Sub"}),e.jsx("button",{onClick:()=>O("dub"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="dub"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"Dub"})]})]}),Z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Loading episodes..."})]}):L?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:L}),e.jsx("button",{onClick:F,className:"btn-primary",children:"Try Again"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto",children:N.episodes.slice().reverse().map(s=>e.jsxs("button",{onClick:()=>ie(s),className:`p-3 rounded-lg text-left transition-colors ${r?.episodeId===s.episodeId?"bg-red-600 text-white":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Episode ",s.number]}),s.isFiller&&e.jsx("span",{className:"text-xs bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded",children:"Filler"})]}),e.jsx("p",{className:"text-xs opacity-90 truncate",children:s.title})]},s.episodeId))})]}),n&&r&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Streaming Servers"}),se?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2 text-sm",children:"Loading servers..."})]}):D?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mb-2",children:D}),e.jsx("button",{onClick:()=>r&&S(r.episodeId),className:"btn-primary text-sm",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-3",children:[n.sub.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Subbed Servers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.sub.map(s=>e.jsxs("button",{onClick:()=>R(s),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${m?.serverId===s.serverId&&o==="sub"?"bg-red-600 text-white":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:[s.serverName," (ID: ",s.serverId,")"]},`sub-${s.serverId}`))})]}),n.dub.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Dubbed Servers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.dub.map(s=>e.jsxs("button",{onClick:()=>R(s),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${m?.serverId===s.serverId&&o==="dub"?"bg-red-600 text-white":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:[s.serverName," (ID: ",s.serverId,")"]},`dub-${s.serverId}`))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:de.genres.map((s,t)=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm",children:s},t))}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:c.description})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Type:"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.stats.type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Episodes:"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:["Sub: ",c.stats.episodes.sub||"N/A"," | Dub: ",c.stats.episodes.dub||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Duration:"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.stats.duration})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Rating:"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.stats.rating})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("img",{src:c.poster,alt:c.name,className:"w-full rounded-lg shadow-lg"}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("a",{href:`https://hianime.to/watch/${d}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",title:"Open on HiAnime.to",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})})]}),K.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Seasons"}),e.jsx("div",{className:"space-y-3",children:K.map(s=>e.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg transition-colors cursor-pointer ${s.id===d?"bg-red-100 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700"}`,onClick:()=>g(`/hianime/${s.id}`),children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-12 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:s.description}),s.id===d&&e.jsx("span",{className:"inline-block mt-1 px-2 py-1 text-xs bg-red-600 text-white rounded",children:"Current"})]})]},s.id))})]}),V.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Related Animes"}),e.jsx(I,{media:V,loading:!1})]}),_.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Recommended Animes"}),e.jsx(I,{media:_,loading:!1})]}),z.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Most Popular Animes"}),e.jsx(I,{media:z,loading:!1})]})]})]})]})})};export{Ae as default};
