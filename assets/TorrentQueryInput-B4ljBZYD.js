import{ad as P,ac as T,ab as S,j as l}from"./index-D07yTCoG.js";import{a as p}from"./utils-COe-vthL.js";import{r as v}from"./router-LUHdcDgl.js";let s=null;try{typeof window>"u"&&(s=require("torrent-search-api"))}catch{console.warn("torrent-search-api not available in browser environment")}const b=[{id:"mock-1",title:"Sample Movie 2024 1080p BluRay x264",provider:"1337x",time:"2 hours ago",size:"2.1 GB",seeds:1250,peers:89,magnet:"magnet:?xt=urn:btih:1234567890abcdef&dn=Sample+Movie+2024",desc:"High quality movie torrent",category:"Movies",url:"https://1337x.to/torrent/1234567890/",infoHash:"1234567890abcdef"},{id:"mock-2",title:"Popular TV Series S01E01 720p HDTV",provider:"ThePirateBay",time:"1 day ago",size:"800 MB",seeds:567,peers:45,magnet:"magnet:?xt=urn:btih:abcdef1234567890&dn=Popular+TV+Series",desc:"Latest episode of popular series",category:"TV",url:"https://thepiratebay.org/description.php?id=1234567890",infoHash:"abcdef1234567890"},{id:"mock-3",title:"Music Album 2024 FLAC",provider:"Rarbg",time:"3 days ago",size:"450 MB",seeds:234,peers:23,magnet:"magnet:?xt=urn:btih:9876543210fedcba&dn=Music+Album+2024",desc:"Lossless music album",category:"Music",url:"https://rarbg.to/torrent/9876543210",infoHash:"9876543210fedcba"}];let y=!1;const u=()=>{if(!(y||!s))try{s.enablePublicProviders(),y=!0,console.log("Torrent Search API initialized with public providers")}catch(e){console.error("Failed to initialize Torrent Search API:",e)}},w=e=>({name:e.name,public:e.public,categories:e.categories}),E=e=>({id:`${e.provider}-${Date.now()}-${Math.random()}`,title:e.title,provider:e.provider,time:e.time||e.date||"Unknown",size:e.size,seeds:e.seeds||0,peers:e.peers||0,magnet:e.magnet,desc:e.desc,category:e.category,subcategory:e.subcategory,url:e.url||e.link,infoHash:e.infoHash,date:e.date,link:e.link,quality:e.quality,language:e.language,uploader:e.uploader,verified:e.verified}),x=()=>{const e=P.getState();return S(e)},U=async e=>{try{const{query:r,category:t="All",limit:a=20,providers:n}=e;if(x()){console.log("Mock data enabled, using mock data for torrent search"),await new Promise(i=>setTimeout(i,1e3));let o=b.filter(i=>{const g=i.title.toLowerCase().includes(r.toLowerCase()),m=!n||n.length===0||n.includes(i.provider);return g&&m});return o=o.slice(0,a),{torrents:o,totalResults:o.length,currentPage:1,hasNextPage:o.length===a}}if(!s){console.log("Torrent Search API not available, using mock data");let o=b.filter(i=>{const g=i.title.toLowerCase().includes(r.toLowerCase()),m=!n||n.length===0||n.includes(i.provider);return g&&m});return o=o.slice(0,a),{torrents:o,totalResults:o.length,currentPage:1,hasNextPage:o.length===a}}console.log("Using real torrent search API"),u();let c=[];n&&n.length>0?c=await s.search(n,r,t==="All"?void 0:t,a):c=await s.search(r,t==="All"?void 0:t,a);const d=c.map(E);return{torrents:d,totalResults:d.length,currentPage:1,hasNextPage:d.length===a}}catch(r){return console.error("Error searching torrents:",r),{torrents:[],totalResults:0,currentPage:1,hasNextPage:!1}}},M=()=>{try{return s?(u(),s.getProviders().map(w)):[]}catch(e){return console.error("Error getting providers:",e),[]}},j=()=>{try{return s?(u(),s.getActiveProviders().map(w)):[]}catch(e){return console.error("Error getting active providers:",e),[]}},H=(e,r)=>{try{return s?(u(),r||s.enableProvider(e),console.log(`Enabled provider: ${e}`,r?"with credentials":"without credentials"),!0):!1}catch(t){return console.error(`Error enabling provider ${e}:`,t),!1}},z=e=>{try{return s?(u(),s.disableProvider(e),console.log(`Disabled provider: ${e}`),!0):!1}catch(r){return console.error(`Error disabling provider ${e}:`,r),!1}},q=()=>{try{return s?(u(),s.enablePublicProviders(),console.log("Enabled all public providers"),!0):!1}catch(e){return console.error("Error enabling all public providers:",e),!1}},N=()=>{try{return s?(u(),s.disableAllProviders(),console.log("Disabled all providers"),!0):!1}catch(e){return console.error("Error disabling all providers:",e),!1}},B=e=>{try{return s?(u(),s.isProviderActive(e)):!1}catch(r){return console.error(`Error checking if provider ${e} is active:`,r),!1}},D=async e=>{try{if(x())return await new Promise(a=>setTimeout(a,300)),e.magnet||`magnet:?xt=urn:btih:${e.infoHash}&dn=${encodeURIComponent(e.title)}`;if(!s)return e.magnet||`magnet:?xt=urn:btih:${e.infoHash}&dn=${encodeURIComponent(e.title)}`;u();const r={title:e.title,provider:e.provider,time:e.time,size:e.size,seeds:e.seeds,peers:e.peers,magnet:e.magnet,desc:e.desc,subcategory:e.subcategory,url:e.url,infoHash:e.infoHash,date:e.date,link:e.link,quality:e.quality,language:e.language,uploader:e.uploader,verified:e.verified};return await s.getMagnet(r)||e.magnet||`magnet:?xt=urn:btih:${e.infoHash}&dn=${encodeURIComponent(e.title)}`}catch(r){return console.error("Error getting magnet URL:",r),e.magnet||`magnet:?xt=urn:btih:${e.infoHash}&dn=${encodeURIComponent(e.title)}`}};class I{baseUrl;constructor(){const r=P.getState();this.baseUrl=T(r)}setBaseUrl(r){this.baseUrl=r}getBaseUrl(){return this.baseUrl}async searchTorrents(r){try{return(await p.get(`${this.baseUrl}/api/v1/search`,{params:{site:r.site,query:r.query},timeout:1e4})).data}catch(t){if(console.error("API torrent search error:",t),p.isAxiosError(t)){if(t.code==="ECONNREFUSED"||t.code==="ENOTFOUND")throw new Error(`Cannot connect to torrent API at ${this.baseUrl}. Please check your API endpoint in settings.`);if(t.response?.status===404)throw new Error("Torrent API endpoint not found. Please check your API endpoint in settings.");if(t.response?.status&&t.response.status>=500)throw new Error("Torrent API server error. Please try again later.");if(t.response?.status===400)throw new Error("Invalid search parameters. Please check your search query.")}throw new Error("Failed to search for torrents. Please check your API endpoint in settings.")}}async searchMovieTorrents(r,t="piratebay"){const a=r.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ");return this.searchTorrents({site:t,query:a})}async searchTVTorrents(r,t,a,n="piratebay"){const c=t.toString().padStart(2,"0"),d=a.toString().padStart(2,"0"),o=`${r} s${c}e${d}`.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ");return this.searchTorrents({site:n,query:o})}getBestTorrent(r){return!r.data||r.data.length===0?null:r.data.sort((a,n)=>{const c=parseInt(a.seeders)||0,d=parseInt(n.seeders)||0,o=a.name.toLowerCase().includes("1080p")||a.name.toLowerCase().includes("4k")||a.name.toLowerCase().includes("hd"),i=n.name.toLowerCase().includes("1080p")||n.name.toLowerCase().includes("4k")||n.name.toLowerCase().includes("hd");return o&&!i?-1:!o&&i?1:d-c})[0].magnet}}const F=new I,V=({initialQuery:e,onQueryChange:r,placeholder:t="Search torrents...",className:a="",debounceMs:n=500})=>{const[c,d]=v.useState(e),[o,i]=v.useState(!1);v.useEffect(()=>{d(e)},[e]);const g=v.useCallback((()=>{let h;return f=>{clearTimeout(h),i(!0),h=setTimeout(()=>{r(f),i(!1)},n)}})(),[r,n]),m=h=>{const f=h.target.value;d(f),g(f)},k=h=>{h.key==="Enter"&&(r(c),i(!1))},A=()=>{d(""),r("")};return l.jsx("div",{className:`mb-4 ${a}`,children:l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l.jsx("svg",{className:`h-5 w-5 ${o?"text-blue-500 animate-spin":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o?l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}):l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("input",{type:"text",value:c,onChange:m,onKeyPress:k,placeholder:t,className:"block w-full pl-10 pr-20 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),l.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center",children:[c&&l.jsx("button",{onClick:A,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 mr-2",title:"Clear search",children:l.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),l.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mr-3",children:o?"Searching...":"Press Enter to search"})]})]})})};export{V as T,j as a,z as b,H as c,N as d,q as e,D as f,M as g,B as i,U as s,F as t};
