import{u as T,a as x,j as n,x as R}from"./index-Dl-wv5iU.js";import{r as c}from"./router-LUHdcDgl.js";const j="https://api.themoviedb.org/3";class _{apiKey;constructor(e){this.apiKey=e}async makeRequest(e,r={}){const u=new URL(`${j}${e}`);u.searchParams.set("api_key",this.apiKey),Object.entries(r).forEach(([t,l])=>{u.searchParams.set(t,String(l))});const o=await fetch(u.toString());if(!o.ok)throw new Error(`TMDB API error: ${o.status} ${o.statusText}`);return o.json()}async searchKeywords(e,r=1){return this.makeRequest("/search/keyword",{query:e,page:r})}async searchMovies(e,r=1){return this.makeRequest("/search/movie",{query:e,page:r})}async searchTV(e,r=1){return this.makeRequest("/search/tv",{query:e,page:r})}async getTrendingMovies(e="week",r=1){return this.makeRequest(`/trending/movie/${e}`,{page:r})}async getTrendingTV(e="week",r=1){return this.makeRequest(`/trending/tv/${e}`,{page:r})}async getMovieDetails(e){return this.makeRequest(`/movie/${e}`,{append_to_response:"videos"})}async getTVDetails(e){return this.makeRequest(`/tv/${e}`,{append_to_response:"videos"})}async getSeasonDetails(e,r){return this.makeRequest(`/tv/${e}/season/${r}`)}async getPopularMovies(e=1){return this.makeRequest("/movie/popular",{page:e})}async getPopularTV(e=1){return this.makeRequest("/tv/popular",{page:e})}async getTopRatedMovies(e=1){return this.makeRequest("/movie/top_rated",{page:e})}async getTopRatedTV(e=1){return this.makeRequest("/tv/top_rated",{page:e})}async getNowPlayingMovies(e=1){return this.makeRequest("/movie/now_playing",{page:e})}async getAiringTodayTV(e=1){return this.makeRequest("/tv/airing_today",{page:e})}async getUpcomingMovies(e=1){return this.makeRequest("/movie/upcoming",{page:e})}async getOnTheAirTV(e=1){return this.makeRequest("/tv/on_the_air",{page:e})}async discoverMovies(e={}){return this.makeRequest("/discover/movie",{page:1,sort_by:"popularity.desc",include_adult:!1,include_video:!1,language:"en-US",...e})}async discoverTV(e={}){return this.makeRequest("/discover/tv",{page:1,sort_by:"popularity.desc",include_adult:!1,include_video:!1,language:"en-US",...e})}async getTVRecommendations(e,r=1){return this.makeRequest(`/tv/${e}/recommendations`,{page:r})}filterByReleaseDate(e,r){if(r)return e;const u=new Date().toISOString().split("T")[0];return e.filter(o=>{const t=o.release_date||o.first_air_date;return t&&t<=u})}}let y=null;const D=i=>((!y||y.apiKey!==i)&&(y=new _(i)),y),q=({videoId:i,onReady:e,onStateChange:r,autoplay:u=!1})=>{const o=c.useRef(null),t=c.useRef(null),l=T(),{playerState:g}=x(s=>s.ui),[f,d]=c.useState(!1);c.useEffect(()=>{if(window.YT){d(!0);return}let s;const a=document.createElement("script");return a.src="https://www.youtube.com/iframe_api",a.async=!0,a.onerror=()=>{console.error("Failed to load YouTube IFrame API"),d(!1)},document.head.appendChild(a),s=setTimeout(()=>{console.warn("YouTube IFrame API loading timeout"),d(!1)},1e4),window.onYouTubeIframeAPIReady=()=>{clearTimeout(s),d(!0)},()=>{s&&clearTimeout(s),a.parentNode&&a.parentNode.removeChild(a),typeof window.onYouTubeIframeAPIReady=="function"&&(window.onYouTubeIframeAPIReady=void 0)}},[]),c.useEffect(()=>{if(!f||!o.current||!i)return;const a=setTimeout(()=>{t.current&&t.current.destroy(),t.current=new window.YT.Player(o.current,{height:"100%",width:"100%",videoId:i,playerVars:{autoplay:u?1:0,controls:1,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,fs:1,cc_load_policy:0,playsinline:1},events:{onReady:()=>{e?.()},onStateChange:p=>{const m=p.data;r?.(m),l(R({isPlaying:m===1,duration:t.current?.getDuration()||0}))},onPlaybackQualityChange:()=>{},onPlaybackRateChange:()=>{},onError:()=>{},onApiChange:()=>{},onVolumeChange:()=>{}}})},100);return()=>clearTimeout(a)},[f,i,l,e,r]);const v=()=>{t.current&&t.current.playVideo()},w=()=>{t.current&&t.current.pauseVideo()},h=s=>{t.current&&t.current.seekTo(s,!0)},b=s=>{t.current&&t.current.setVolume(s*100)},k=()=>{if(t.current){const s=t.current.getIframe();s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen?s.webkitRequestFullscreen():s.msRequestFullscreen&&s.msRequestFullscreen()}};return c.useEffect(()=>{const s=a=>{if(!(a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement))switch(a.key.toLowerCase()){case"k":a.preventDefault(),g.isPlaying?w():v();break;case"j":a.preventDefault();const p=t.current?.getCurrentTime()||0;h(Math.max(0,p-10));break;case"l":a.preventDefault();const m=t.current?.getCurrentTime()||0;h(m+10);break;case"f":a.preventDefault(),k();break;case"m":a.preventDefault();break}};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[g.isPlaying]),c.useEffect(()=>{t.current&&(window.youtubePlayer={play:v,pause:w,seekTo:h,setVolume:b,toggleFullscreen:k})},[i]),n.jsxs("div",{className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden",children:[n.jsx("div",{ref:o,className:"w-full h-full"}),!f&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:n.jsxs("div",{className:"text-white text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),n.jsx("p",{children:"Loading YouTube API..."}),n.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"This may take a few seconds"})]})})]})},M=({isOpen:i,onClose:e,videoId:r,title:u})=>(c.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i]),c.useEffect(()=>{const o=t=>{t.key==="Escape"&&i&&e()};return i&&document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[i,e]),!i||!r?null:n.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-75 transition-opacity",onClick:e}),n.jsxs("div",{className:"relative w-full max-w-4xl mx-4 bg-white dark:bg-gray-800 rounded-lg shadow-2xl overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:u||"Trailer"}),n.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:n.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("div",{className:"p-4",children:n.jsx("div",{className:"aspect-video",children:n.jsx(q,{videoId:r,autoplay:!0})})})]})]}));export{M as Y,D as g};
