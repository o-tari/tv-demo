import{u as z,a as x,Z as ee,_ as G,$ as se,j as e,F as U,a0 as te,a1 as oe,a2 as re,a3 as ae,a4 as ie,S as ne,L as le}from"./index-D07yTCoG.js";import{r as c,L as de}from"./router-LUHdcDgl.js";import{g as Z}from"./YouTubePlayerModal-ChLYb3h5.js";import{T as q}from"./TMDBMediaCard-CPMjJ7zp.js";import{g as ce,c as he}from"./newEpisodeUtils-JBZCrWGO.js";import{L as pe}from"./LazyImage-Cgmg7ZD0.js";import"./vendor-gH-7aFTg.js";import"./redux-uMWmO1IK.js";import"./utils-COe-vthL.js";import"./formatNumber-CanhB8v4.js";class ue{tmdbService;constructor(r){this.tmdbService=Z(r)}async processItemsForNewEpisodes(r){const d=[];for(const a of r){if(a.type!=="tv"||!a.lastWatchedEpisode){d.push({...a,hasNewEpisodes:!1,newEpisodesCount:0});continue}try{const i=await this.tmdbService.getTVDetails(a.tmdbId);if(!i.seasons){d.push({...a,hasNewEpisodes:!1,newEpisodesCount:0});continue}const t=await ce(this.tmdbService,a.tmdbId,i.seasons),p=he(a.lastWatchedEpisode,t);d.push({...a,hasNewEpisodes:p.hasNewEpisodes,newEpisodesCount:p.newEpisodesCount})}catch(i){console.error("Error checking for new episodes for item:",a.title,i),d.push({...a,hasNewEpisodes:!1,newEpisodesCount:0})}}return d.sort((a,i)=>a.hasNewEpisodes===i.hasNewEpisodes?i.lastWatchedTime-a.lastWatchedTime:a.hasNewEpisodes?-1:1)}}let T=null;const ge=n=>((!T||T.tmdbService.apiKey!==n)&&(T=new ue(n)),T),ve=({limit:n,showMoreButton:r=!1,onMoreClick:d})=>{const a=z(),i=x(ee),t=x(G),[p,R]=c.useState(!1);c.useEffect(()=>{if(t&&i.length>0){const o=ge(t),u=setTimeout(()=>{o.processItemsForNewEpisodes(i).then(v=>{a(se(v))}).catch(v=>{console.error("Error processing items for new episodes:",v)})},500);return()=>clearTimeout(u)}},[t,i.length,a]);const f=n&&!p?i.slice(0,n):i,S=n?i.length>n:!1,w=(o,u)=>{u.preventDefault(),u.stopPropagation(),console.log("Removing item from TMDB continue watching:",o),a(oe(o))},C=()=>{d?d():R(!p)},y=o=>o?`https://image.tmdb.org/t/p/w500${o}`:"/placeholder-movie.svg",k=o=>`/tmdb-watch/${o.type}/${o.tmdbId}`,M=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return i.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Continue Watching"}),S&&r&&e.jsx("button",{onClick:C,className:"text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 font-medium",children:p?"Show Less":"More"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:f.map(o=>e.jsxs("div",{className:"relative group",children:[e.jsx(de,{to:k(o),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{src:y(o.thumbnail),alt:o.title,className:"w-full aspect-[3/4] object-cover rounded-lg",placeholder:e.jsx(U,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[e.jsxs("span",{className:"bg-black bg-opacity-80 text-white text-xs px-1.5 py-0.5 rounded flex items-center",children:[e.jsx("span",{className:"text-yellow-400 mr-1",children:"â˜…"}),o.rating.toFixed(1)]}),o.hasNewEpisodes&&e.jsx("span",{className:"bg-red-600 text-white text-xs px-2 py-0.5 rounded-full font-semibold animate-pulse",children:"New"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white group-hover:text-red-600 dark:group-hover:text-red-400 line-clamp-2",children:o.title}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-600 rounded-full flex-shrink-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.type==="movie"?e.jsx(U,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:o.type==="movie"?"Movie":"TV Show"}),e.jsx("div",{className:"flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-500",children:e.jsx("span",{children:M(o.publishedAt)})})]})]})]})]})}),e.jsx("button",{onClick:u=>w(o.id,u),className:"absolute top-2 right-2 p-2 bg-red-600 hover:bg-red-700 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-lg","aria-label":"Remove from Continue Watching",title:"Remove from Continue Watching",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},o.id))})]})},me=({limit:n})=>{const r=x(re),d=z(),a=t=>{d(ae(t))};if(r.length===0)return null;const i=n?r.slice(0,n):r;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Watch Later"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length," ",r.length===1?"item":"items"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6",children:i.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsx(q,{id:t.tmdbId,title:t.title,thumbnail:t.thumbnail,duration:null,viewCount:void 0,publishedAt:t.publishedAt,channelTitle:null,type:t.type,rating:t.rating,overview:t.overview,content:{id:t.tmdbId,title:t.title,name:t.title,poster_path:t.thumbnail,overview:t.overview,vote_average:t.rating,vote_count:0,release_date:t.publishedAt,first_air_date:t.publishedAt}}),e.jsx("button",{onClick:()=>a(t.id),className:"absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200",title:"Remove from Watch Later",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t.id))}),n&&r.length>n&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>{},className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors",children:"View All Watch Later"})})]})},Se=()=>{const n=x(G),r=x(ie),[d,a]=c.useState([]),[i,t]=c.useState([]),[p,R]=c.useState([]),[f,S]=c.useState([]),[w,C]=c.useState([]),[y,k]=c.useState([]),[M,o]=c.useState([]),[u,v]=c.useState([]),[H,L]=c.useState(!1),[J,E]=c.useState({tvRecommendations:{displayedCount:15,hasMore:!1},trendingMovies:{displayedCount:15,hasMore:!1},trendingTV:{displayedCount:15,hasMore:!1},discoverMovies:{displayedCount:15,hasMore:!1},discoverTV:{displayedCount:15,hasMore:!1},nowPlayingMovies:{displayedCount:15,hasMore:!1},popularMovies:{displayedCount:15,hasMore:!1},topRatedMovies:{displayedCount:15,hasMore:!1}});c.useEffect(()=>{n&&O()},[n,r]);const O=async()=>{if(n){L(!0);try{const s=Z(n),[h,V,D,j,b,l,Y]=await Promise.all([s.getTrendingMovies("week"),s.getTrendingTV("week"),s.discoverMovies(),s.discoverTV(),s.getNowPlayingMovies(),s.getPopularMovies(),s.getTopRatedMovies()]),I=s.filterByReleaseDate(h.results,r),N=s.filterByReleaseDate(V.results,r),B=s.filterByReleaseDate(D.results,r),W=s.filterByReleaseDate(j.results,r),A=s.filterByReleaseDate(b.results,r),_=s.filterByReleaseDate(l.results,r),F=s.filterByReleaseDate(Y.results,r);if(a(I),t(N),S(B),C(W),k(A),o(_),v(F),E(m=>({...m,trendingMovies:{displayedCount:15,hasMore:I.length>15},trendingTV:{displayedCount:15,hasMore:N.length>15},discoverMovies:{displayedCount:15,hasMore:B.length>15},discoverTV:{displayedCount:15,hasMore:W.length>15},nowPlayingMovies:{displayedCount:15,hasMore:A.length>15},popularMovies:{displayedCount:15,hasMore:_.length>15},topRatedMovies:{displayedCount:15,hasMore:F.length>15}})),N.length>0)try{const m=await s.getTVRecommendations(N[0].id),$=s.filterByReleaseDate(m.results,r);R($),E(K=>({...K,tvRecommendations:{displayedCount:15,hasMore:$.length>15}}))}catch(m){console.error("Error loading TV recommendations:",m)}}catch(s){console.error("Error loading trending content:",s)}finally{L(!1)}}},Q=s=>{E(h=>({...h,[s]:{...h[s],displayedCount:Math.min(h[s].displayedCount+15,P(s)),hasMore:h[s].displayedCount+15<P(s)}}))},P=s=>{switch(s){case"tvRecommendations":return p.length;case"trendingMovies":return d.length;case"trendingTV":return i.length;case"discoverMovies":return f.length;case"discoverTV":return w.length;case"nowPlayingMovies":return y.length;case"popularMovies":return M.length;case"topRatedMovies":return u.length;default:return 0}},X=s=>{switch(s){case"tvRecommendations":return p;case"trendingMovies":return d;case"trendingTV":return i;case"discoverMovies":return f;case"discoverTV":return w;case"nowPlayingMovies":return y;case"popularMovies":return M;case"topRatedMovies":return u;default:return[]}},g=(s,h,V)=>{const D=X(h),j=J[h],b=D.slice(0,j.displayedCount);return H?e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:s}),e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(le,{})})]}):b.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:s}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6",children:b.map(l=>e.jsx(q,{id:l.id,title:"title"in l?l.title:l.name,thumbnail:l.poster_path,duration:null,viewCount:l.vote_count,publishedAt:"release_date"in l?l.release_date:l.first_air_date,channelTitle:null,type:V,rating:l.vote_average,overview:l.overview,content:l,trailerVideoId:null},`${h}-${l.id}`))}),j.hasMore&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>Q(h),className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors",children:"Load More"})})]})};return n?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Movies & TV"}),e.jsx("div",{className:"max-w-2xl",children:e.jsx(ne,{searchPath:"/movies-tv/search"})})]}),e.jsxs("div",{className:"space-y-12",children:[e.jsx(ve,{limit:10}),e.jsx(me,{limit:10}),g("Recommended TV Shows","tvRecommendations","tv"),g("Trending Movies","trendingMovies","movie"),g("Trending TV Shows","trendingTV","tv"),g("Discover Movies","discoverMovies","movie"),g("Discover TV Shows","discoverTV","tv"),g("Now Playing Movies","nowPlayingMovies","movie"),g("Popular Movies","popularMovies","movie"),g("Top Rated Movies","topRatedMovies","movie")]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Movies & TV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-lg mb-8",children:"Please configure your TMDB API key in settings to access movies and TV shows."}),e.jsx("a",{href:"/settings",className:"inline-flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors",children:"Go to Settings"})]})})})};export{Se as default};
